import{a as $,b as U,r as f,M as _,A as V,N as L,j as A,w as s,O as C,P as z,o as F,f as o,h as p,i as M,Q as B,v as I,R as N,x as O}from"./index-cf1bc7ce.js";/* empty css                  */import{l as R,M as u,b as q,r as E}from"./user-6c240784.js";import{_ as S}from"./_plugin-vue_export-helper-0fe1062f.js";const Z="https://github.com/login/oauth/authorize",j=$({__name:"Login",props:{code:{}},setup(b){const g=b,w=`${Z}?client_id=66770019f90670c913af&redirect_uri=https://www.ppos.top/#/login`,d=U(),c=f(),r=_({username:"",password:""}),h=_({username:[{required:!0,message:"用户名不能为空",trigger:"blur"},{min:2,max:10,message:"用户名为2~10个字符",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5a-zA-Z0-9]{2,10}$/,message:"请输入中文、英文、数字",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"change"},{pattern:/^[a-zA-Z0-9@#!*]{6,8}$/,message:"请输入英文、数字、@#!*",trigger:"change"}]}),m=f(!1),v=async a=>{a&&await a.validate(async(e,l)=>{if(e)try{let t=await q(r.username,r.password),i={username:r.username,token:t.data.token,role:"admin",lastlogin:t.data.lastlogin,headUrl:t.data.headUrl,expire:t.data.expire};d.Login(i)}catch(t){u(t,"error")}else console.log("error submit!",l)})},y=async a=>{a&&await a.validate(async(e,l)=>{if(e)try{await E(r.username,r.password),u("注册成功","success")}catch(t){u(t,"error")}else console.log("error submit!",l)})};return V(async()=>{if(g.code&&!d.state){window.location.search="",m.value=!0,console.log("OAuth登录中。。");try{let a=await R(g.code);console.log("ret data",a.data);let e={token:a.data.token,role:"admin",username:a.data.username,headUrl:a.data.headUrl,lastlogin:void 0,expire:a.data.expire};d.Login(e)}catch{u("OAuth登录失败","error")}finally{m.value=!1}}}),(a,e)=>{const l=I,t=N,i=O,x=C,k=z;return L((F(),A(x,{inline:!1,rules:h,ref_key:"formRef",ref:c,model:r,"label-width":"auto",class:"login-form-inline"},{default:s(()=>[o(t,{label:"账号",prop:"username"},{default:s(()=>[o(l,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=n=>r.username=n),maxlength:"10",class:"el-input",placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),o(t,{label:"密码",prop:"password"},{default:s(()=>[o(l,{modelValue:r.password,"onUpdate:modelValue":e[1]||(e[1]=n=>r.password=n),maxlength:"10",class:"el-input",placeholder:"请输入密码",clearable:"","show-password":""},null,8,["modelValue"])]),_:1}),o(t,{label:" "},{default:s(()=>[o(i,{type:"primary",onClick:e[2]||(e[2]=n=>v(c.value))},{default:s(()=>[p("登录")]),_:1}),o(i,{onClick:e[3]||(e[3]=n=>y(c.value))},{default:s(()=>[p("注册")]),_:1}),o(i,{onClick:e[4]||(e[4]=n=>M(B)(w))},{default:s(()=>[p("Github登录")]),_:1})]),_:1})]),_:1},8,["rules","model"])),[[k,m.value]])}}});const H=S(j,[["__scopeId","data-v-e7265b7b"]]);export{H as default};
